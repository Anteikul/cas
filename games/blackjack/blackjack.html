<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackjack</title>
<style>
  :root{
    --bg:#0b0f14; --edge:#1c2940; --text:#e7f1fb; --muted:#9bb0c9;
    --accent:#5aa7ff; --good:#35d18a; --bad:#ff6b6b;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,sans-serif;}
  *{box-sizing:border-box}
  header.appbar{
    position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;
    padding:10px 16px;background:linear-gradient(#0d141f,#0b0f14);border-bottom:1px solid var(--edge);
  }
  .lobby-btn{
    display:inline-flex;align-items:center;gap:6px;padding:10px 12px;
    border:1px solid var(--edge);border-radius:12px;background:transparent;color:var(--text);
    text-decoration:none;font-weight:600;cursor:pointer;
  }
  .lobby-btn:hover{background:rgba(255,255,255,.04);}
  .balance-pill{margin-left:auto;display:flex;align-items:center;gap:8px;padding:6px 10px;background:#0f1625;border:1px solid var(--edge);border-radius:999px}
  .balance-pill .amount{font-weight:700;}
  main{padding:16px;display:flex;flex-direction:column;align-items:center;gap:16px;}
  #table{display:flex;gap:40px;}
  .hand{min-width:160px;min-height:90px;padding:10px;border:1px solid var(--edge);border-radius:12px;background:#121825;}
  .hand span{margin-right:4px;}
  .controls{display:flex;gap:8px;margin-top:10px;}
  button{padding:10px 12px;border-radius:12px;border:1px solid var(--edge);background:#0c1220;color:var(--text);cursor:pointer;}
  button:disabled{opacity:.5;cursor:not-allowed;}
  .message{min-height:24px;}
</style>
</head>
<body>
<header class="appbar">
  <a class="lobby-btn" href="../../index.html">‚Üê Lobby</a>
  <div class="balance-pill"><span class="amount balance-amount">0.00</span></div>
</header>
<main>
  <div>
    <label class="muted" for="bet-amount">Bet</label>
    <input id="bet-amount" type="number" min="1" step="1" value="10">
  </div>
  <div class="controls">
    <button id="deal-btn">Deal</button>
    <button id="hit-btn" disabled>Hit</button>
    <button id="stand-btn" disabled>Stand</button>
  </div>
  <div id="table">
    <div class="hand" id="dealer-hand"></div>
    <div class="hand" id="player-hand"></div>
  </div>
  <div class="message" id="status"></div>
</main>
<script src="../../js/common.js"></script>
<script>
const {$, placeBet, payout} = Common;
let deck=[], player=[], dealer=[], inRound=false;

function buildDeck(){
  deck=[];
  const suits=['H','D','C','S'];
  for(const s of suits){ for(let v=1; v<=13; v++){ deck.push({s,v}); } }
}
function shuffle(){
  for(let i=deck.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [deck[i],deck[j]]=[deck[j],deck[i]];
  }
}
function cardLabel(c){
  const names={1:'A',11:'J',12:'Q',13:'K'};
  const v=names[c.v]||c.v;
  return v+c.s;
}
function handToString(hand){
  return hand.map(cardLabel).join(' ');
}
function handValue(hand){
  let total=0, aces=0;
  for(const c of hand){
    if(c.v===1){ total+=11; aces++; }
    else if(c.v>10){ total+=10; }
    else total+=c.v;
  }
  while(total>21 && aces>0){ total-=10; aces--; }
  return total;
}
function renderHands(hideDealer){
  $('#player-hand').textContent = handToString(player) + ' ('+handValue(player)+')';
  if(hideDealer){
    $('#dealer-hand').textContent = cardLabel(dealer[0]) + ' ??';
  }else{
    $('#dealer-hand').textContent = handToString(dealer) + ' ('+handValue(dealer)+')';
  }
}
function deal(){
  if(inRound) return;
  if(!placeBet()) return;
  inRound=true;
  buildDeck(); shuffle();
  player=[deck.pop(), deck.pop()];
  dealer=[deck.pop(), deck.pop()];
  $('#hit-btn').disabled=false;
  $('#stand-btn').disabled=false;
  $('#deal-btn').disabled=true;
  $('#status').textContent='';
  renderHands(true);
  if(handValue(player)===21){ endRound('blackjack'); }
}
function hit(){
  if(!inRound) return;
  player.push(deck.pop());
  renderHands(true);
  if(handValue(player)>21){ endRound('lose'); }
}
function stand(){
  if(!inRound) return;
  while(handValue(dealer)<17){ dealer.push(deck.pop()); }
  renderHands(false);
  const pv=handValue(player), dv=handValue(dealer);
  if(dv>21 || pv>dv) endRound('win');
  else if(pv===dv) endRound('push');
  else endRound('lose');
}
function endRound(type){
  inRound=false;
  $('#deal-btn').disabled=false;
  $('#hit-btn').disabled=true;
  $('#stand-btn').disabled=true;
  renderHands(false);
  let mult=0, msg='';
  if(type==='blackjack'){ mult=2.5; msg='Blackjack!'; }
  else if(type==='win'){ mult=2; msg='You win!'; }
  else if(type==='push'){ mult=1; msg='Push.'; }
  else { msg='You lose.'; }
  if(mult>0) payout(mult);
  $('#status').textContent=msg;
}
$('#deal-btn').addEventListener('click', deal);
$('#hit-btn').addEventListener('click', hit);
$('#stand-btn').addEventListener('click', stand);
</script>
</body>
</html>
